description: "TDS Virtual TA Project Evaluation Config"

prompts:
  - "{{ prompt }}"

providers:
  - id: https
    config:
      url: https://aiproxy.sanand.workers.dev/openai/v1/chat/completions
      method: POST
      headers:
        Content-Type: application/json
        Authorization: "Bearer {{env.OPENAI_API_KEY}}"
      body:
        model: gpt-4o-mini
        messages:
          - role: user
            content: "{{ prompt }}"
        temperature: 0
      transformResponse: |
        const content = json.choices?.[0]?.message?.content || "";
        const links = Array.from(content.matchAll(/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g)).map(m => ({
          text: m[1],
          url: m[2]
        }));
        return { answer: content, links };

defaultTest:
  assert:
    - type: is-json
      value:
        type: object
        required: [answer, links]
        properties:
          answer: { type: string }
          links:
            type: array
            items:
              type: object
              required: [url, text]
              properties:
                url: { type: string }
                text: { type: string }

tests:
  - name: Sample test
    provider: https
    vars:
      prompt: What is FastAPI?

writeLatestResults: true
